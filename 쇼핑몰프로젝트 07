#include <stdio.h>
#include <string.h>

#define MAX 5
#define LEN 50

typedef struct {
    char name[LEN];
    int code;
    int price;
    int stock;
    int sold;
} Product;

int main() {
    Product p[MAX];
    int count = 0;
    int choice, i, code, qty;
    FILE *fp;

    while (1) {
        printf("원하는 메뉴를 선택하세요.(1.입고, 2.판매, 3.개별현황, 4.전체현황, 5.저장, 6.불러오기, 7.종료)\n");
        scanf("%d", &choice);

        if (choice == 1) {
            printf("상품코드 입력: ");
            scanf("%d", &code);
            int found = -1;
            for (i = 0; i < count; i++) {
                if (p[i].code == code) {
                    found = i;
                    break;
                }
            }
            if (found != -1) {
                printf("기존상품이 있습니다. 입고 수량 입력: ");
                scanf("%d", &qty);
                p[found].stock += qty;
            } else {
                if (count >= MAX) {
                    printf("상품등록 한도(5개)를 초과했습니다.\n");
                    continue;
                }
                printf("새 상품 등록.\n상품명 입력: ");
                scanf("%s", p[count].name);
                p[count].code = code;
                printf("상품가격 입력: ");
                scanf("%d", &p[count].price);
                printf("입고 수량 입력: ");
                scanf("%d", &p[count].stock);
                p[count].sold = 0;
                count++;
            }
        }

        else if (choice == 2) {
            if (count == 0) {
                printf("등록된 상품이 없습니다.\n");
                continue;
            }
            printf("판매할 상품코드 입력: ");
            scanf("%d", &code);
            int found = -1;
            for (i = 0; i < count; i++) {
                if (p[i].code == code) {
                    found = i;
                    break;
                }
            }
            if (found == -1) {
                printf("상품이 존재하지 않습니다.\n");
                continue;
            }
            printf("판매 수량 입력: ");
            scanf("%d", &qty);
            if (qty > p[found].stock) {
                printf("재고가 부족합니다.\n");
                continue;
            }
            p[found].stock -= qty;
            p[found].sold += qty;
        }

        else if (choice == 3) {
            if (count == 0) {
                printf("등록된 상품이 없습니다.\n");
                continue;
            }
            printf("상품코드 입력: ");
            scanf("%d", &code);
            int found = -1;
            for (i = 0; i < count; i++) {
                if (p[i].code == code) {
                    found = i;
                    break;
                }
            }
            if (found == -1) {
                printf("상품이 존재하지 않습니다.\n");
                continue;
            }
            printf("상품명: %s\n", p[found].name);
            printf("상품코드: %d\n", p[found].code);
            printf("상품가격: %d\n", p[found].price);
            printf("재고수량: %d\n", p[found].stock);
            printf("판매수량: %d\n", p[found].sold);
            printf("총판매금액: %d\n", p[found].sold * p[found].price);
        }

        else if (choice == 4) {
            if (count == 0) {
                printf("등록된 상품이 없습니다.\n");
                continue;
            }
            int total_sales = 0;
            printf("=== 전체 상품 현황 ===\n");
            for (i = 0; i < count; i++) {
                int revenue = p[i].sold * p[i].price;
                printf("[%d] %s | 코드:%d | 가격:%d | 재고:%d | 판매:%d | 총판매금액:%d\n",
                       i + 1, p[i].name, p[i].code, p[i].price, p[i].stock, p[i].sold, revenue);
                total_sales += revenue;
            }
            printf("총 판매금액 합계: %d\n", total_sales);
        }

        else if (choice == 5) {
            fp = fopen("product.txt", "w");
            if (fp == NULL) {
                printf("파일 저장 실패.\n");
                continue;
            }
            fprintf(fp, "%d\n", count);
            for (i = 0; i < count; i++) {
                fprintf(fp, "%s %d %d %d %d\n", p[i].name, p[i].code, p[i].price, p[i].stock, p[i].sold);
            }
            fclose(fp);
            printf("상품정보가 파일에 저장되었습니다.\n");
        }

        else if (choice == 6) {
            fp = fopen("product.txt", "r");
            if (fp == NULL) {
                printf("파일을 불러올 수 없습니다.\n");
                continue;
            }
            fscanf(fp, "%d", &count);
            for (i = 0; i < count; i++) {
                fscanf(fp, "%s %d %d %d %d", p[i].name, &p[i].code, &p[i].price, &p[i].stock, &p[i].sold);
            }
            fclose(fp);
            printf("상품정보를 파일에서 불러왔습니다.\n");
        }

        else if (choice == 7) {
            printf("프로그램을 종료합니다.\n");
            break;
        }

        else {
            printf("잘못된 입력입니다.\n");
        }
    }

    return 0;
}
